<html>
<head>
    <title>Custom Login</title>
    <script>
        window.onload = function () {
            // Check login status
            fetch('/public/me')
                .then(res => res.ok ? res.json() : Promise.reject())
                .then(data => {
                    document.getElementById('loginStatus').innerText = `âœ… Logged in as: ${data.username}`;
                })
                .catch(() => {
                    document.getElementById('loginStatus').innerText = 'âŒ Not logged in';
                });

            // Handle error and logout messages
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('error')) {
                document.getElementById('status').innerText = 'âŒ Login failed. Please try again.';
                document.getElementById('status').style.color = 'red';
            }
            if (urlParams.has('logout')) {
                document.getElementById('status').innerText = 'âœ… You have been logged out.';
                document.getElementById('status').style.color = 'green';
            }

            // Dropdown change handler
            document.getElementById('apiDropdown').addEventListener('change', function () {
                const selectedPath = this.value;
                if (selectedPath) {
                    fetch(selectedPath)
                        .then(res => res.text())
                        .then(data => {
                            document.getElementById('apiResponse').innerText = data;
                        })
                        .catch(err => {
                            document.getElementById('apiResponse').innerText = 'âŒ Error fetching API.';
                        });
                } else {
                    document.getElementById('apiResponse').innerText = '';
                }
            });
        };
    </script>
</head>
<body>
<h2>Login Page</h2>

<!-- This form mimics Spring's default login page -->
<form method="POST" action="/login">
    <label>Username:</label>
    <input type="text" name="username" required><br>

    <label>Password:</label>
    <input type="password" name="password" required><br><br>

    <button type="submit">Login</button>
</form>

<p id="status"></p>

<h3>Login Status</h3>
<p id="loginStatus">Checking...</p>

<hr>

<h3>Choose an API to call:</h3>
<select id="apiDropdown">
    <option value="">-- Select an endpoint --</option>
    <option value="/public/home">ğŸ  Public Home</option>
    <option value="/public/contact">ğŸ“ Public Contact</option>
    <option value="/private/balance">ğŸ’° Private Balance</option>
    <option value="/private/message">ğŸ“© Private Message</option>
    <option value="/admin/announcement">ğŸ“¢ Admin Announcement</option>
    <option value="/admin/loan">ğŸ¦ Admin Loan</option>
</select>

<h3>API Response:</h3>
<pre id="apiResponse" style="background:#f0f0f0;padding:10px;"></pre>

</body>
</html>
